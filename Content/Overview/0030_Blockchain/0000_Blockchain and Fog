#  MobileCoin's Blockchain and Fog Speed Up Transactions to Seconds

Almost 30 years ago knowledge gaps in how to use the Internet stymied the digital transformation and the advent of the World Wide Web. Most asked, "The world wide what"? Trust was a factor. Could you trust your money to online stores? Speed was another. Dial-up was agonizingly slow and laborious. A decade later, we embraced the Web, where Amazon and other digital companies grew like wildfire.

We see a similar scenario building in the digital transformation of cryptographic payments. Cryptocurrency currently is too slow for day-to-day transactions. It can take up to 60 minutes to conduct a transaction on Bitcoin. If you want to buy a cup of coffee, an hour's wait isn't going to cut it.

We can do better. If Bitcoin is digital gold, MobileCoin is digital cash. 

Gold is great for saving for a rainy day, cash is king when it comes to your everyday needs. What separates cash from gold? Speed, privacy, and usability. Gold is heavy, cash is light. Pulling a gold bar out at a coffee shop would be mighty risky, but cash is quick and well understood. Converting a gold bar into change would take a hammer, chisel, and a weighing station, but cash is easily divisible.

There is room on this earth for more than one type of asset, but your coffee shop needs digital cash.  

Transforming SmartPhones with Digital Cash
------------------------------------------

Digital cash must be fast and private, which is why MobileCoin has invested so much time into making our technology easy to use. The first component is the MobileCoin Blockchain, which is a digital ledger that records financial information of financial transactions. The second component is MobileCoin Fog, a back-end service that allows users to quickly and privately send, spend, and check the balance of their MOB via their smartphone.

To help understand the importance of the MobileCoin technology, this explanation delivers four layers of increasingly more complex information geared toward describing the concepts to:

-   Five-year-old children who probably have never spent money in their entire short lives.

-   Grandparents who probably are not familiar with cryptocurrency, but have searched on Google, written checks, balanced their checkbooks, and transacted online through their local banks.

-   College first years who are familiar with digital cash, like Bitcoin, smartphones, and messaging apps, like Signal and WhatsApp.

-   Software engineers who have studied digital payment systems, blockchain databases, and cryptography.

## What is the MobileCoin BlockChain?

Blockchain is a new technology that is decentralizing trade and allowing peer-to-peer transactions to occur, removing the intermediaries. How does MobileCoin use this innovation to allow two people to send digital cash using their smartphones?

### To a Five-Year Old Child:

Imagine you have a bag of puzzle pieces and you give a piece to each of your friends. If you all get together, you can solve the puzzle. However, if someone brings a piece from another puzzle, or you are missing a piece, the puzzle remains unsolved. Whenever someone in the world wants to buy something, you or one of your friends needs to place a new puzzle piece down.

### To a Grandparent:

Blockchain is like a counting mechanism, a ledger. It is similar to the invention of double-entry accounting, which is a bookkeeping method that has been used since the 1400s. Double-entry accounting involves recording each transaction in two accounts, resulting in a credit to one account and a debit to another. The resulting transaction must balance out. Blockchains make it harder to cheat by having many different copies of the ledger, each held by a different person who all come together to agree on the information in their ledgers. The technology ensures that the accounts always balance, and no one can cheat.

### To a First Year College Student:

The importance of blockchain is that it democratizes information. It allows people to trade one-on-one. Anyone can validate that the transactions are valid. Blockchain is keeping track of data in a way that blocks large corporations or big tech companies from tracking the user's data to sell. For example, Google, AWS, and Microsoft provide cloud services, but the users' data is the product, which the technology companies can sell. Blockchain can be used for multiple uses, not just finance. It is a trustworthy database that can be used for running video games, tracking physical goods, recording weather and/or sports scores, or as a supply chain.

The blockchain itself is an append-only sequence (ledger) of all transactions. It uses cryptography to encode all of the transactions, so no one can see what has happened. This also means that previous transactions cannot be changed because the cryptography reveals if someone has tried to manipulate the data. To create a new entry in the ledger, you take the existing ledger and use a mathematical equation to add information to the chain which ensures that each new entry is provably linked to all prior transactions. The math proves truth -- any inconsistencies reveal that someone has tampered with the ledger.

### To a Software Engineer:

Blockchain is a decentralized approach to keeping track of data. It can be a ledger, a log, or a history of important items. On a blockchain network, there are multiple types of participants: servers, nodes, miners (in the case of Bitcoin's blockchain network), and/or computers. Each one of the nodes receives a proposed transaction. If one of the nodes in a trusted group of peers has a different set of transactions than the rest of the nodes, the other servers correct the mistake through consensus. As the consensus mechanism reaches its conclusion, a new block is appended to the chain using a cryptographic proof known as a hash. Succinctly, this is why it is called a blockchain: it is a chain of blocks linked by cryptographic knowledge.

The MobileCoin Blockchain is a digital ledger that records financial information of financial transactions, the giving and receiving of funds. The design of the MobileCoin Blockchain ledger is based on the privacy-preserving CryptoNote ledger protocol, which obscures the identity of all users' transaction outputs (TxOuts) using one-time recipient addresses. The transaction is encrypted by Ring Confidential Transactions (RingCT), which hides the actual transaction value amid decoys, a larger set of possibly-spent transactions. The MobileCoin Blockchain is encrypted, which means that the TxOuts are constructed in such a way that users can only receive funds or know how much they have spent by using their private keys to view or spend the transaction. Explicitly: only the counterparties in a transaction are privy to its contents.

Each TxOut is annotated with a Merkle proof of inclusion, a secret committed message in a finite group of messages, in the MobileCoin Blockchain ledger. A Merkle proof of inclusion (or membership) can be validated without going to the ledger database and in constant time -- without revealing which output the user is spending. Additionally, MobileCoin's Blockchain improves on the baseline privacy offered by CryptoNote and RingCT by deleting input rings for every transaction before the new payment is appended to the public ledger. This provably destroys the transaction graph.

One erroneous assumption about blockchains is that it is being used for both the consensus mechanism, how the servers decide on what data to append to the blockchain, and the record of those decisions, that is, the result of the consensus. Technically, the blockchain is just the record of those decisions finalized in "blocks." However, a lot of people conflate the two.

The blockchain is the result of the consensus validation. Consensus occurs after a certain number of servers (peers) vote together that the outputs being sent from one person to another are legitimate thereby coming to "consensus" on the next valid block. If they all agree the transactions are legitimate, the peers accept the transaction, and they append the encrypted part of that transaction to the blockchain. Only the recipient has the private key to decrypt it.

MobileCoin's Blockchain differs from other blockchains. Other networks retain complete copies of all transactions, so new participants can validate the chain independently. Alternatively, MobileCoin uses MobileCoin Fog to offload the transactional data. Once a transaction has been validated, most of its data is discarded. Only the information necessary to make new transactions are saved in the MobileCoin Blockchain, such as key images and outputs. MobileCoin protects users from data leakage, location monitoring, and surveillance.

Using MobileCoin Fog (discussed next), MobileCoin has made the blockchain private and secure for smartphone usage.

What is MobileCoin Fog?
-----------------------

MobileCoin Fog is a new technology developed by MobileCoin, which is a privacy-preserving service designed to support use of the MobileCoin payments network on mobile devices. MobileCoin Fog is designed so that MobileCoin and the messaging app's service operators have limited insight into users' payments. Most people understand what the Cloud is, a type of technology infrastructure that hosts an organization's network capabilities and resources in a public or private remote computing platform. Fog is similar in that it is cloud, but opaque. You cannot see what is going on inside a Fog service. It is a private system. How does MobileCoin use this technology to allow two people to send digital cash to each other using their smartphone?

### To a Five-Year Old Child:

Pretend that you have a glass jar of marbles. You are the owner of the jar. You can see who wants a marble and what marbles other kids pick out of the jar. But! What if Bobby wants to pick out a marble without you knowing which one it is? He wants it to be his secret only. Maybe, you add a bunch of cotton around all of the marbles. Bobby now can reach into the jar and pull out a marble without you knowing which one he pulled out. Even though you own the jar of marbles, Bobby can secretly remove a marble without you knowing which one it is. You know he is taking a marble, but that is all. That is what MobileCoin Fog does. It keeps Bobby's marble choice private, so no one else knows, not even you, the owner of the jar, what marble he chose.

### To a Grandparent:

MobileCoin Fog is similar to private information retrieval. What if you want to find out about RVing in Alaska? You search on Google for campsites. The Google team keeps track of your searches. All of a sudden, you start seeing ads for campers, camping gear, and camping insurance. Somebody at Google has shared your searches with advertisers. When you use MobileCoin to send payments through your smartphone, the information is encrypted and no one, not even the operators at Signal or any other messaging app that you are using, can see what you have spent or with whom. No one can track your spending habits. MobileCoin Fog makes this possible and practical on a mobile device, as well.

### To a First Year College Student:

MobileCoin Fog makes information retrieval private for digital cash. Cryptocurrency is a form of online money where no trusted institution, like a bank or government, is responsible for the value or the stewardship of the currency. The issue with Bitcoin, a different cryptocurrency, is that it is not private. Anyone can track back your transactions to the beginning of the Bitcoin, harvest that data, and sell it to advertisers. It is also not super easy to use because you have to download the wallet software and understand the technology. And, finally, it is very slow. It can take anywhere from ten minutes to 60 minutes for a transaction to go through.

In cryptography, the ability to retrieve information from a server that you do not own without the operator of that server knowing what information you are trying to recover, is called private information retrieval. Hiding the access pattern is extremely difficult to do. A technology, called oblivious RAM (ORAM), helps this happen. MobileCoin Fog is the first production-grade open-source implementation of ORAM that exists today.

In addition, MobileCoin has placed the ORAM data structures inside Intel's Software Guard eXtension (SGX) secure enclaves, which means reads and writes do not correlate transactions with users, even in the event of a side-channel exploit against SGX. Fog serves queries privately by not revealing significant transaction information, and without compromising scalability.

Fog's query service provides an alternative to downloading the entire blockchain, which is critical for mobile devices. Users do not have to test every transaction using their cryptographic keys, which saves significant bandwidth and computations required for every new transaction. Fog does a form of processing of the blockchain, but does it for the users and without needing their private keys. Fog ingest, the server that houses the ORAM in the SGX enclave, looks at the blockchain as it gets updated and decrypts part of each transaction. Fog prepares this decrypted information for the user to retrieve at a later point, so that users can make queries to Fog about their transactions, and check their balances and send transactions to others. The smartphone can make an oblivious request against the oblivious database in Fog. And no one knows what you are spending your MOB on! It is private, fast, and easy to use.

MobileCoin's cryptocurrency payment system runs on Signal, which is an encrypted messaging app. People used to use Pretty Good Privacy (PGP) to send encrypted messages via email. But, for the normal person, PGP was difficult to use. Signal developed a way to send an encrypted message without anyone having to think about the underlying cryptography. Similarly, MobileCoin has created a cryptocurrency that has an encrypted blockchain where you do not have to think about the underlying technology. In fact, when you use Signal, you do not send a cryptocurrency address. You literally just type in a phone number and hit send on your smartphone. Fog lets this happen.

### To a Software Engineer:

MobileCoin Fog is a solution to the central scalability problem of privacy coins.\
The scalability problem is the following -- by design, no one can determine who owns a particular coin, without having the private keys of the owner. However, this forces all participants to download all the transactions and scan them with their private keys, which is prohibitive on mobile devices, and onerous for casual users. Alternatively, one could give away their private keys, but this seriously harms privacy, and the central service may be too expensive to run.

MobileCoin Fog is a solution to this problem, which:

-   Privately indexes the blockchain, so that your TxOut's have pseudorandom keys that only you can predict

-   Provides a way to privately search the blockchain for your pseudorandom keys

-   Provides a way to privately complete balance checks and build transactions, obviating the need to download the ledger completely.

Fog is dramatically more efficient than view-key scanning each transaction with each user's keys -- it does only a small amount of work per transaction and does not do work per user and per transaction, so that it can scale up to a billion users.

A single Fog server currently supports hundreds of private queries per second across the entire MobileCoin ledger, and speed is expected to improve as we continue to optimize it.

Fog's private search functionality is based on a nascent technology called Oblivious RAM. This technology has been studied for decades but not shipped in a real production web service until MobileCoin launched Fog. Fog also makes critical use of Intel SGX enclaves and works within the SGX threat model to ensure that the Fog service operators have no insight into your transactions. This aspect of Fog was inspired in part by the Signal Contact Discovery service.

Fog ensures that even in a threat model where MobileCoin operators and Signal operators are hacking into the operating systems of their machines and attempting to scour them for evidence, they are unable to determine the amount or the recipient of your transaction, without penetrating Intel SGX security guarantees.

Fog also has a forward secrecy property, so that if a vulnerability is found in SGX, it recovers gracefully after the patch. Crucially, users' private keys are never inside of Fog SGX enclaves, and they always remain on your mobile device.

Architecturally, Fog consists of four scalable microservices, and a database which stores a post-processed version of the blockchain (with the private indexing information).

-   Fog Ingest:

This service is responsible for post-processing the blockchain and creating the private indexes. The Fog Ingest SGX enclave maintains a private key, and emits the public key in an SGX-signed record called the Fog Report. When sending MOB to a Fog address, MobileCoin users obtain the report and encrypt part of the address (the view public key) for Fog Ingest, so that it can know who to tag the payment for. This ciphertext becomes part of the TxOut and goes into the blockchain when the TxOut is validated. Later, Fog Ingest picks it up, and the enclave is able to perform the private indexing. The private indexing works by creating a cryptographic PRNG for each user -- these PRNGs are stored in an Oblivious RAM inside of SGX. The seed to the PRNG is created by key exchange against the user's public key, and the key exchange message gets committed to the database. This ensures that the users can always reconstruct their RNGs as long as they have their private keys. TxOut's are tagged with successive outputs of the RNGs, and then committed to the database. After this, the Fog Ingest enclave deletes each TxOut's specific information, to create forward secrecy.

-   Fog View:

This service is responsible for helping users privately find their TxOut's based on the indexing performed by Fog Ingest. Fog View makes it possible for users to find key exchange messages so that they can build their RNGs. Fog View also hosts an oblivious RAM inside of an SGX enclave into which it loads all of the post-processed TxOut's. It then supports private queries based on outputs of PRNGs, so that users can privately download exactly their TxOut's.

-   Fog Ledger:

This service is responsible for helping users perform other tasks that would otherwise require downloading the blockchain ledger. One such task is performing key-image checks, which resolves if a TxOut that you downloaded is already spent or not, and is a critical step in balance checking. Another such task is building Merkle proofs of membership for your TxOut, which is required to submit to consensus. This is also an SGX service and all queries like this are mediated by oblivious RAM, similar to Fog View.

-   Fog Report:

This service hosts the Fog Report -- it is accessible to all users, so that they can send transactions to Fog users.

### Summary

All together, these microservices are the basis of Signal's integration with MobileCoin, providing the best-in-class mobile payments experience, in terms of convenience, ease of use, speed, cost, and privacy.  For more information, check out: <https://mobilecoin.com/beta>.
